-- Chatting 방 생성
DROP SEQUENCE CHATNOSEQ;
DROP TABLE CHATROOMS;

CREATE SEQUENCE CHATNOSEQ;

CREATE TABLE CHATROOMS(
	CHAT_NO NUMBER NOT NULL,
	ROOM_ID VARCHAR2(1000) NOT NULL PRIMARY KEY,
	CREATOR_ID VARCHAR2(1000) NOT NULL REFERENCES MEMBER(MEMBER_ID) ON DELETE CASCADE,
	GUEST_ID VARCHAR2(1000) NOT NULL REFERENCES MEMBER(MEMBER_ID) ON DELETE CASCADE,
	CREATE_DATE DATE NOT NULL
);

SELECT CHAT_NO, ROOM_ID, CREATOR_ID, GUEST_ID, CREATE_DATE
FROM CHATROOMS
ORDER BY CREATE_DATE DESC;

DELETE FROM CHATROOMS;

-- Chatting 메세지 기록
DROP SEQUENCE CHATSEQ;
DROP TABLE CHATMESSAGES;

CREATE SEQUENCE CHATSEQ;

CREATE TABLE CHATMESSAGES(
	ROOM_SEQ NUMBER PRIMARY KEY,
	ROOM_ID VARCHAR2(1000) NOT NULL REFERENCES CHATROOMS(ROOM_ID) ON DELETE CASCADE,
	FROM_ID VARCHAR2(1000) NOT NULL REFERENCES MEMBER(MEMBER_ID) ON DELETE CASCADE,
	TO_ID VARCHAR2(1000) NOT NULL REFERENCES MEMBER(MEMBER_ID) ON DELETE CASCADE,
	MESSAGE VARCHAR2(4000) NOT NULL,
	SEND_DATE DATE NOT NULL
);

SELECT ROOM_SEQ, ROOM_ID, FROM_ID, TO_ID, MESSAGE, SEND_DATE FROM CHATMESSAGES ORDER BY SEND_DATE ASC;

DELETE FROM CHATMESSAGES;

SELECT ROOM_ID, FROM_ID, TO_ID, MESSAGE, SEND_DATE
FROM CHATMESSAGES
ORDER BY SEND_DATE DESC;

SELECT ROWNUM, c.*
FROM (SELECT ROOM_ID, FROM_ID, TO_ID, MESSAGE, SEND_DATE
		FROM CHATMESSAGES
		ORDER BY SEND_DATE DESC) c
WHERE ROWNUM = 1;
